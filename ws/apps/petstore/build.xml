

<project name="petstore" default="war" basedir=".">

  <property file="${user.home}/build.properties" />
  <property file="./setup/derby.properties" />
  
  <import file="./setup/setup.xml" />
  <import file="../../setup/common-ant.xml" />

  <property name="module.name" value="petstore" />

  <property name="dist.dir" value="dist" />
  <property name="app.module" value="${dist.dir}/petstore.war" />
    
  <property name="build.dir" value="build" />
  <property name="src.web" value="web" />
  <property name="build.classes.dir" value="${build.dir}/classes" />
  <property name="war.build.dir" value="${build.dir}/war" />
  <property name="commons.script" value="lib/js/ajax-commons.js" /> 
  <property name="dojo.script" value="lib/dojo/dojo.js" />


  <target name="build" description="Compile petstore files." >
    <mkdir dir="${build.classes.dir}" />
    <javac srcdir="src/java" destdir="${build.classes.dir}">
      <include name="**/*.java" />
	  <classpath refid="classpath"/>
	</javac>
  </target>
  
  <target name="war" depends="build" description="Packages the War file">
    <mkdir dir="${war.build.dir}"/>
    <!-- Copy in the compiled Classes -->
    <copy todir="${war.build.dir}/WEB-INF/classes">
     <fileset dir="${build.classes.dir}"/>
    </copy>  
    <copy todir="${war.build.dir}/WEB-INF/classes/META-INF" file="${src.web}/WEB-INF/persistence.xml"/>
    <!-- Copy in the content -->
    <copy todir="${war.build.dir}">
     <fileset dir="${src.web}"/>
    </copy>
    <copy file="${commons.script}" todir="${war.build.dir}" />
    <copy file="${dojo.script}" todir="${war.build.dir}" />
    <copy todir="${war.build.dir}">
     <fileset dir="${war.build.dir}"/>
    </copy> 
    <mkdir dir="${dist.dir}"/>
    <delete file="${app.module}"/>
    <jar jarfile="${app.module}" basedir="${war.build.dir}" />
    <delete dir="${war.build.dir}"/>
  </target>
  
  <target name="package-persistence-jar" depends="build" description="Packages the persistence unit">
    <mkdir dir="${jar.build.dir}"/>
    <!-- Copy in the compiled Classes -->
    <copy todir="${jar.build.dir}">
      <fileset dir="${build.classes.dir}">
      </fileset>
    </copy>
    <delete file="${jar.build.dir}/com/sun/javaee/blueprints/petstore/model/Category.class"/>
    <delete file="${jar.build.dir}/com/sun/javaee/blueprints/petstore/model/Customer.class"/>
    <delete file="${jar.build.dir}/com/sun/javaee/blueprints/petstore/model/Item.class"/>
    <delete file="${jar.build.dir}/com/sun/javaee/blueprints/petstore/model/Order.class"/>   
    <copy todir="${jar.build.dir}/META-INF" file="${src.web}/WEB-INF/persistence.xml"/>
    <delete file="./build/catalog-persistence.jar"/>
    <jar jarfile="./build/catalog-persistence.jar" basedir="${jar.build.dir}" />
    <delete dir="${jar.build.dir}"/>
  </target>

  <target name="clean" description="Cleans up">
    <delete dir="${dist.dir}"/>
    <delete dir="${build.dir}"/>
  </target>

</project>





